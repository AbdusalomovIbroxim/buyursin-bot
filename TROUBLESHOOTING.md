# Руководство по устранению сетевых проблем

## Проблемы, которые вы наблюдаете:

### 1. WinError 64: The specified network name is no longer available
**Причина:** Сетевое соединение прервалось или стало недоступным.

**Решения:**
- Проверьте стабильность интернет-соединения
- Попробуйте переключиться на другой Wi-Fi или мобильный интернет
- Перезагрузите роутер/модем
- Проверьте, не блокирует ли провайдер Telegram

### 2. WinError 121: The semaphore timeout period has expired
**Причина:** Windows не может получить доступ к сетевым ресурсам из-за таймаута.

**Решения:**
- Перезагрузите компьютер
- Проверьте настройки брандмауэра Windows
- Отключите антивирус временно для тестирования
- Сбросьте сетевые настройки Windows:
  ```cmd
  netsh winsock reset
  netsh int ip reset
  ipconfig /flushdns
  ```

### 3. Общие рекомендации для стабильной работы:

#### Настройки Windows:
1. **Отключите энергосбережение сетевого адаптера:**
   - Сетевые подключения → Свойства → Настройка → Управление питанием
   - Снимите галочку "Разрешить отключение для экономии энергии"

2. **Настройте DNS:**
   - Используйте публичные DNS: 8.8.8.8, 8.8.4.4 (Google) или 1.1.1.1 (Cloudflare)

3. **Проверьте брандмауэр:**
   - Разрешите Python и ваш бот в брандмауэре Windows

#### Альтернативные решения:

1. **Использование VPN:**
   - Если Telegram заблокирован, используйте VPN

2. **Переход на webhook (для продакшена):**
   ```python
   # В main.py раскомментируйте webhook режим
   await dis.start_webhook(
       bot,
       webhook_path="/webhook",
       webhook_url="https://yourdomain.com/webhook",
   )
   ```

3. **Использование прокси:**
   ```python
   # В dispatcher/dispatcher.py добавьте прокси
   bot = Bot(token=config.BOT_TOKEN, proxy="http://proxy:port")
   ```

#### Мониторинг и логирование:

1. **Проверьте логи регулярно:**
   - Ищите паттерны в ошибках
   - Отслеживайте время восстановления соединения

2. **Настройте уведомления:**
   - Добавьте уведомления администратору при критических ошибках

#### Команды для диагностики:

```cmd
# Проверка подключения к Telegram
ping api.telegram.org

# Проверка DNS
nslookup api.telegram.org

# Сброс сетевого стека
netsh winsock reset
netsh int ip reset
ipconfig /flushdns
ipconfig /renew
```

## Обновления в коде:

1. **Увеличены таймауты** - теперь бот ждет дольше перед повторными попытками
2. **Добавлена экспоненциальная задержка** - время ожидания увеличивается с каждой попыткой
3. **Улучшено логирование** - более детальная информация об ошибках
4. **Оптимизированы HTTP настройки** - лучшая производительность сети

## Если проблемы продолжаются:

1. Попробуйте запустить бота на другом компьютере/сервере
2. Используйте VPS с Linux вместо Windows
3. Рассмотрите возможность использования webhook вместо polling
4. Обратитесь к провайдеру интернета для проверки блокировок 
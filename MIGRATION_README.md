# Миграция базы данных

## Добавление поля admin_message_id

Для корректной работы новой функциональности (редактирование сообщений в админ группе после одобрения/отклонения) необходимо добавить новое поле `admin_message_id` в таблицу `ads`.

### Способ 1: Автоматическая миграция

Запустите скрипт миграции:

```bash
python migrate_db.py
```

### Способ 2: Ручная миграция

Если автоматическая миграция не работает, выполните следующие SQL команды:

```sql
ALTER TABLE ads ADD COLUMN admin_message_id INTEGER;
```

### Способ 3: Пересоздание базы данных

Если у вас нет важных данных в базе, можно пересоздать её:

1. Удалите файл `db.sqlite`
2. В `main.py` раскомментируйте строку `await db.drop_all()`
3. Запустите бота один раз
4. Закомментируйте обратно строку `await db.drop_all()`

## Что изменилось

1. **Модель Ads**: Добавлено поле `admin_message_id` для хранения ID сообщения в админ группе
2. **Обработчик ad.py**: Теперь сохраняет ID сообщения в админ группе при создании объявления
3. **Обработчик admin.py**: 
   - При одобрении: редактирует сообщение, убирая кнопки и добавляя "✅ ОДОБРЕНО"
   - При отклонении: редактирует сообщение, убирая кнопки и добавляя "❌ ОТКЛОНЕНО"

## Результат

После одобрения или отклонения объявления в админ группе:
- Кнопки "Одобрить"/"Отклонить" исчезают
- Добавляется соответствующая отметка (✅ ОДОБРЕНО или ❌ ОТКЛОНЕНО)
- Сообщение больше не может быть обработано повторно 